{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="max-width:1200px; margin:0 auto;">

    <!-- Dashboard Header -->
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h2 style="color:var(--teal); margin:0;">Dashboard</h2>
        <div>
            <a href="{% url 'add_patient' %}" style="background-color:var(--teal); color:white; padding:10px 20px; text-decoration:none; border-radius:5px; margin-right:10px;">Add Patient</a>
            <a href="{% url 'upload_dicom' %}" style="background-color:var(--green); color:white; padding:10px 20px; text-decoration:none; border-radius:5px;">Upload DICOM</a>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:20px; margin-bottom:30px;">
        <div style="padding:20px; background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); border-left:4px solid var(--teal);">
            <h3 style="margin:0 0 10px 0; font-size:14px; color:#666;">Total Patients</h3>
            <p style="margin:0; font-size:32px; font-weight:bold; color:var(--teal);">{{ patients.count }}</p>
        </div>
        <div style="padding:20px; background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); border-left:4px solid var(--teal);">
            <h3 style="margin:0 0 10px 0; font-size:14px; color:#666;">DICOM Studies</h3>
            <p style="margin:0; font-size:32px; font-weight:bold; color:var(--teal);">{{ total_dicom_studies }}</p>
        </div>
        <div style="padding:20px; background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); border-left:4px solid var(--teal);">
            <h3 style="margin:0 0 10px 0; font-size:14px; color:#666;">X-Ray Procedures</h3>
            <p style="margin:0; font-size:32px; font-weight:bold; color:var(--teal);">{{ xray_count }}</p>
        </div>
        <div style="padding:20px; background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); border-left:4px solid var(--teal);">
            <h3 style="margin:0 0 10px 0; font-size:14px; color:#666;">Ultrasound Procedures</h3>
            <p style="margin:0; font-size:32px; font-weight:bold; color:var(--teal);">{{ ultrasound_count }}</p>
        </div>
    </div>

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px;">
        <!-- Patients Table -->
        <div style="background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); overflow:hidden;">
            <div style="padding:15px; background-color:var(--teal); color:white;">
                <h3 style="margin:0;">Recent Patients</h3>
            </div>
            <div style="padding:20px;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="border-bottom:2px solid #eee;">
                            <th style="padding:12px; text-align:left;">Name</th>
                            <th style="padding:12px; text-align:left;">Procedure</th>
                            <th style="padding:12px; text-align:left;">Scheduled</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for patient in patients|slice:":5" %}
                        <tr style="border-bottom:1px solid #eee;">
                            <td style="padding:12px;">
                                <strong>{{ patient.first_name }} {{ patient.last_name }}</strong>
                                <br><small style="color:#666;">{{ patient.phone_number }}</small>
                            </td>
                            <td style="padding:12px;">
                                <span style="background-color:{% if patient.procedure_type == 'xray' %}#17a2b8{% else %}var(--green){% endif %}; 
                                      color:white; 
                                      padding:4px 8px; border-radius:12px; font-size:12px; font-weight:bold;">
                                    {{ patient.procedure_type|upper }}
                                </span>
                            </td>
                            <td style="padding:12px;">
                                {{ patient.scheduled_date }}<br>
                                <small style="color:#666;">{{ patient.scheduled_time }}</small>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3" style="padding:20px; text-align:center; color:#666;">No patients found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% if patients.count > 5 %}
                <div style="text-align:center; margin-top:15px;">
                    <a href="#" style="color:var(--teal); text-decoration:none; font-weight:500;">View All Patients</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- DICOM Studies Table -->
        <div style="background:white; border-radius:8px; box-shadow:0 2px 4px rgba(0,0,0,0.1); overflow:hidden;">
            <div style="padding:15px; background-color:var(--green); color:white;">
                <h3 style="margin:0;">Recent DICOM Studies</h3>
            </div>
            <div style="padding:20px;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="border-bottom:2px solid #eee;">
                            <th style="padding:12px; text-align:left;">Study ID</th>
                            <th style="padding:12px; text-align:left;">Patient</th>
                            <th style="padding:12px; text-align:left;">Priority</th>
                            <th style="padding:12px; text-align:left;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for dicom in recent_dicom_studies %}
                        <tr style="border-bottom:1px solid #eee; border-left:4px solid 
                            {% if dicom.exam_priority == 'urgent' %}#dc3545
                            {% elif dicom.exam_priority == 'stat' %}var(--green)
                            {% else %}var(--teal)
                            {% endif %};">
                            <td style="padding:12px;">
                                <small><strong>{{ dicom.study_id }}</strong></small>
                                <br><small style="color:#666;">{{ dicom.upload_time|date:"M d, Y H:i" }}</small>
                            </td>
                            <td style="padding:12px;">{{ dicom.patient.first_name }} {{ dicom.patient.last_name }}</td>
                            <td style="padding:12px;">
                                <span style="background-color:
                                    {% if dicom.exam_priority == 'urgent' %}#dc3545
                                    {% elif dicom.exam_priority == 'stat' %}var(--green)
                                    {% else %}var(--teal)
                                    {% endif %}; 
                                    color:white;
                                    padding:4px 8px; border-radius:12px; font-size:11px; font-weight:bold;">
                                    {{ dicom.exam_priority|upper }}
                                </span>
                            </td>
                            <td style="padding:12px;">
                                <a href="{% url 'download_dicom' dicom.id %}" 
                                   style="background-color:var(--teal); color:white; padding:6px 12px; text-decoration:none; border-radius:4px; font-size:12px;"
                                   title="Download DICOM File">
                                    Download
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" style="padding:20px; text-align:center; color:#666;">No DICOM studies found.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
